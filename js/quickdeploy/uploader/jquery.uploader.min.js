!function(l){var a="QuickDeploy: jQuery Uploader";l.fn.uploader=function(r){return r=l.extend({},{acceptedFiles:"image/png,image/jpeg,image/gif",additionalData:{},dateCallback:null,deleteUrl:"",maxFilesize:window.hasOwnProperty("settings")&&window.settings.hasOwnProperty("maxFilesize")?window.settings.maxFilesize.MB:16,onDelete:function(e,a,t){var s=(l(a).find("[data-uploader-id]").length?l(a).find("[data-uploader-id]"):l(a)).data();confirm("Are you sure you want do delete this?")&&l.ajax(r.deleteUrl,{dataType:"json",async:!1,method:"post",beforeSend:showLoader,complete:hideLoader,data:{data:JSON.stringify(r.additionalData),uploader:{aspect:s.uploaderAspect,format:s.uploaderFormat,id:s.uploaderId,source:s.uploaderSource,type:s.uploaderType}},success:function(e){switch(e.status){case"success":l(a).load(location.href+" #"+l(a).prop("id")+">*",function(){return l(this).children().length?void l(a).uploader(t):l(this).remove()});break;case"error":displayMessage(e.message,"alert");break;case"debug":default:displayMessage(e,"alert")}},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}})},onView:function(e,a){a=(l(a).find("[data-uploader-source]").length?l(a).find("[data-uploader-source]"):l(a)).data();l('<div id="uploader-image-preview-modal" class="modal fade" aria-hidden="true" tabindex="-1">\t<div class="modal-dialog modal-dialog-centered d-flex justify-content-center modal-xl">\t\t<div class="position-relative">\t\t\t<img src="'+a.uploaderSource+'" class="img-fluid mb-0" style="max-height:80vh!important">\t\t\t<div class="card-img-overlay pb-0">\t\t\t\t<button class="btn btn-link text-white float-right p-0" type="button" aria-label="Close" data-dismiss="modal">\t\t\t\t\t<i class="fal fa-times-circle fa-2x"></i>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t</div></div>').on("hidden.bs.modal",function(){l(this).remove()}).modal()},progressBarUrl:"",stageUrl:"",uploadUrl:""},"object"==typeof r?r:{}),this.each(function(e,o){l(o).find('div[id^="image-uploader-stage"]').each(function(e,i){l(i).css("width",800);try{new Dropzone(i,{url:r.uploadUrl,acceptedFiles:r.acceptedFiles,createImageThumbnails:!1,previewsContainer:!1,paramName:"image",maxFiles:1,maxFilesize:r.maxFilesize,params:{data:JSON.stringify(r.additionalData)},success:function(e,t){var s=this;t=JSON.parse(t),l("#progress-modal").on("hidden.bs.modal",function(){switch(t.status){case"success":var a;t.edit?l.ajax({dataType:"html",async:!0,method:"get",beforeSend:showLoader,complete:hideLoader,success:function(e){l(o).html(l(e).find("#"+l(o).prop("id"))).uploader(r)},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}}):(l(i).replaceWith(l('<div id="image-uploader-stage" class="row justify-content-center"/>')),(a=l('div[id^="image-uploader-stage"]')).append(l("<input/>",{type:"hidden",name:"filename",value:t.filename})),l.ajax(r.stageUrl,{dataType:"html",async:!0,method:"post",beforeSend:null,complete:null,data:t,success:function(e){a.append(e)},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}}),r.dateCallback instanceof Function&&r.dateCallback(t.datetime));break;case"error":displayMessage(t.message,"alert"),s.removeAllFiles(!0);break;default:displayMessage(t.message||"An unknown error has occurred","alert"),s.removeAllFiles(!0)}}).modal("hide")},totaluploadprogress:function(e,a,t){e=Math.floor(e)+"%";0<t&&(l(".progress-bar").css("width",e),l("#progress-label").html(e))},sending:function(){var a=this;l.ajax(r.progressBarUrl,{method:"post",dataType:"html",async:!1,success:function(e){l("footer").append(e),l("#progress-modal").on("hidden.bs.modal",function(){l(this).remove()}).modal()},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert"),a.removeAllFiles(!0)}})},error:function(e,a){l("#progress-modal").modal("hide"),displayMessage(a,"alert"),this.removeAllFiles(!0)}})}catch(e){console.error(a,e.message)}}),l(o).off("click").on("click","[data-uploader-action]",function(e){switch(e.preventDefault(),l(this).data("uploader-action")){case"delete":r.onDelete(l(this),o,r);break;case"view":r.onView(l(this),o,r);break;default:console.error(a,"Unknown Action",l(this).data("uploader-action"))}})})}}(jQuery);