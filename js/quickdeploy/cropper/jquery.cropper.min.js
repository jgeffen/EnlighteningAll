!function(c){var d="QuickDeploy: jQuery Cropper";c.fn.cropper=function(i){return i=c.extend({},{acceptedFiles:"image/png,image/jpeg",additionalData:{},backgroundColor:"#FFFFFF",cropperModalUrl:"",cropUrl:"",dateCallback:null,deleteUrl:"",maxFilesize:window.hasOwnProperty("settings")&&window.settings.hasOwnProperty("maxFilesize")?window.settings.maxFilesize.MB:16,onCrop:function(e,r,o){var s=(e.find("[data-cropper-source]").length?e.find("[data-cropper-source]"):c(r).find("[data-cropper-source]").length?c(r).find("[data-cropper-source]"):c(r)).data();c.ajax(o.cropperModalUrl,{dataType:"html",async:!1,method:"post",beforeSend:showLoader,complete:hideLoader,data:{data:JSON.stringify(o.additionalData),template:JSON.stringify(o.template),cropper:{aspect:s.cropperAspect,format:s.cropperFormat,id:s.cropperId,source:s.cropperSource,type:s.cropperType}},success:function(e){c(e).on("shown.bs.modal",function(){var t=c(this);try{new Cropper(c("#image-cropper-modal-image")[0],{dragMode:"move",cropBoxResizable:!0,autoCropArea:.8,aspectRatio:s.cropperAspect,ready:function(){var a=this.cropper;c("#image-cropper-modal-controls").on("click",'a[id^="image-cropper-modal-controls"]',function(e){switch(e.preventDefault(),c(this).prop("id")){case"image-cropper-modal-controls-rotate":a.rotate(90);break;case"image-cropper-modal-controls-zoom-in":a.zoom(.1);break;case"image-cropper-modal-controls-zoom-out":a.zoom(-.1);break;case"image-cropper-modal-controls-cancel":t.modal("hide");break;case"image-cropper-modal-controls-submit":c.ajax(o.cropUrl,{dataType:"json",async:!1,method:"post",beforeSend:showLoader,complete:hideLoader,data:{backgroundColor:o.backgroundColor,data:JSON.stringify(o.additionalData),cropper:{aspect:s.cropperAspect,data:a.getData(!0),format:s.cropperFormat,id:s.cropperId,source:s.cropperSource,type:s.cropperType}},success:function(e){var a=e.hasOwnProperty("thumb")?e.thumb:e.source;switch(e.status){case"success":c(r).find('img[src^="'+a+'"]').prop("src",a+"?v="+Date.now()),t.modal("hide");break;case"error":displayMessage(e.message||"An unknown error has occurred.","alert");break;case"debug":default:console.log(e)}},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}})}})}})}catch(e){console.error(d,e.message)}}).on("hidden.bs.modal",function(){c(this).remove()}).modal({backdrop:"static",keyboard:!1}).find("div.modal-content").css({"max-width":"100%","max-height":"100%",width:"100vw",height:"100vh"})},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}})},onDelete:function(e,a,t){var r=(c(a).find("[data-cropper-id]").length?c(a).find("[data-cropper-id]"):c(a)).data();confirm("Are you sure you want do delete this?")&&c.ajax(i.deleteUrl,{dataType:"json",async:!1,method:"post",beforeSend:showLoader,complete:hideLoader,data:{data:JSON.stringify(i.additionalData),template:JSON.stringify(i.template),cropper:{aspect:r.cropperAspect,format:r.cropperFormat,id:r.cropperId,source:r.cropperSource,type:r.cropperType}},success:function(e){switch(e.status){case"success":c(a).load(location.href+" #"+c(a).prop("id")+">*",function(){return c(this).children().length?void c(a).cropper(t):c(this).remove()});break;case"error":displayMessage(e.message,"alert");break;case"debug":default:displayMessage(e,"alert")}},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}})},onView:function(e,a){a=(c(a).find("[data-cropper-source]").length?c(a).find("[data-cropper-source]"):c(a)).data();c('<div id="cropper-image-preview-modal" class="modal fade" aria-hidden="true" tabindex="-1">\t<div class="modal-dialog modal-dialog-centered d-flex justify-content-center modal-xl">\t\t<div class="position-relative">\t\t\t<img src="'+a.cropperSource+'" class="img-fluid mb-0" style="max-height:80vh!important">\t\t\t<div class="card-img-overlay pb-0">\t\t\t\t<button class="btn btn-link text-white float-right p-0" type="button" aria-label="Close" data-dismiss="modal">\t\t\t\t\t<i class="fal fa-times-circle fa-2x"></i>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t</div></div>').on("hidden.bs.modal",function(){c(this).remove()}).modal()},progressBarUrl:"",stageUrl:"",template:{width:800,height:533},type:"public",uploadUrl:""},"object"==typeof i?i:{}),this.each(function(e,s){c(s).find('div[id^="image-cropper-uploader"]').each(function(e,o){var a=c(o).data("cropper-template")||i.template;c(o).css("width",a.width||800);try{new Dropzone(o,{url:i.uploadUrl,acceptedFiles:i.acceptedFiles,createImageThumbnails:!1,previewsContainer:!1,paramName:"image",maxFiles:1,maxFilesize:i.maxFilesize,params:{backgroundColor:i.backgroundColor,data:JSON.stringify(i.additionalData),template:JSON.stringify(i.template)},success:function(e,a){var r=this;a=JSON.parse(a),c("#progress-modal").on("hidden.bs.modal",function(){switch(a.status){case"success":var t;a.edit?c.ajax({dataType:"html",async:!0,method:"get",beforeSend:showLoader,complete:hideLoader,success:function(e){c(s).html(c(e).find("#"+c(s).prop("id"))).cropper(i)},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}}):(c(o).replaceWith(c('<div id="image-cropper-uploaded" class="row justify-content-center"/>')),(t=c('div[id^="image-cropper-uploaded"]')).append(c("<input/>",{type:"hidden",name:"filename",value:a.filename})),c.each(a.sizes,function(e,a){c.ajax(i.stageUrl,{dataType:"html",async:!0,method:"post",beforeSend:null,complete:null,data:a,success:function(e){t.append(e)},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert")}})}),i.dateCallback instanceof Function&&i.dateCallback(a.datetime));break;case"error":displayMessage(a.message,"alert"),r.removeAllFiles(!0);break;default:displayMessage(a.message||"An unknown error has occurred","alert"),r.removeAllFiles(!0)}}).modal("hide")},totaluploadprogress:function(e,a,t){e=Math.floor(e)+"%";0<t&&(c(".progress-bar").css("width",e),c("#progress-label").html(e))},sending:function(){var a=this;c.ajax(i.progressBarUrl,{method:"post",dataType:"html",async:!1,success:function(e){c("footer").append(e),c("#progress-modal").on("hidden.bs.modal",function(){c(this).remove()}).modal()},error:function(e){displayMessage(e.status+": "+e.statusText+" ("+this.url+")","alert"),a.removeAllFiles(!0)}})},error:function(e,a){c("#progress-modal").modal("hide"),displayMessage(a,"alert"),this.removeAllFiles(!0)}})}catch(e){console.error(d,e.message)}}),c(s).off("click").on("click","[data-cropper-action]",function(e){switch(e.preventDefault(),c(this).data("cropper-action")){case"crop":i.onCrop(c(this),s,i);break;case"delete":i.onDelete(c(this),s,i);break;case"view":i.onView(c(this),s,i);break;default:console.error(d,"Unknown Action",c(this).data("cropper-action"))}})})}}(jQuery);